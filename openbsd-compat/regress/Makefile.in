# $Id: Makefile.in,v 1.2 2006/08/17 09:40:35 dtucker Exp $

sysconfdir=@sysconfdir@
piddir=@piddir@
srcdir=@srcdir@
top_srcdir=@top_srcdir@

VPATH=@srcdir@
CC=@CC@
LD=@LD@
CFLAGS=@CFLAGS@
CPPFLAGS=-I. -I.. -I$(srcdir) -I$(srcdir)/.. @CPPFLAGS@ @DEFS@
LIBS=@LIBS@
LDFLAGS=-L.. -lopenbsd-compat @LDFLAGS@

LIBCOMPAT=../libopenbsd-compat.a
TESTPROGS=closefromtest strtonumtest strduptest snprintftest

all:	t-exec ${OTHERTESTS}

t-exec:	$(TESTPROGS)
	@echo running compat regress tests
	@for TEST in ""$?; do \
		echo "run test $${TEST}" ... 1>&2; \
		./$${TEST} || exit $$? ; \
	done
	@echo finished compat regress tests

strtonumtest: strtonumtest.c $(LIBCOMPAT)
	$(CC) $(CFLAGS) $(CPPFLAGS) -o strtonumtest $< $(LDFLAGS)

strduptest: strduptest.c $(LIBCOMPAT)
	$(CC) $(CFLAGS) $(CPPFLAGS) -o strduptest $< $(LDFLAGS)

closefromtest: closefromtest.c $(LIBCOMPAT)
	$(CC) $(CFLAGS) $(CPPFLAGS) -o closefromtest $< $(LDFLAGS)

clean:
	rm -f *.o *.a core $(TESTPROGS) valid.out

distclean: clean
	rm -f Makefile *~
